<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lao Lottery Cloud - Pro Statistics</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #e5e7eb; margin: 0; padding: 20px; }
        .card { max-width: 700px; margin: auto; background: #1e293b; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: #38bdf8; }
        .status-badge { background: #334155; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; display: inline-block; margin-bottom: 20px; }
        textarea { width: 100%; height: 100px; background: #0f172a; border: 1px solid #334155; color: #38bdf8; padding: 10px; border-radius: 10px; box-sizing: border-box; outline: none; }
        textarea:focus { border-color: #38bdf8; }
        button { width: 100%; padding: 15px; margin-top: 10px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-import { background: #22c55e; color: #052e16; }
        .btn-import:hover { background: #16a34a; }
        .btn-undo { background: #64748b; color: white; font-size: 0.8rem; padding: 10px; }
        .btn-gen { background: #38bdf8; color: #082f49; font-size: 1.1rem; margin-bottom: 20px; }
        
        .hot-container { background: #0f172a; padding: 15px; border-radius: 15px; margin-top: 20px; border: 1px dashed #38bdf8; }
        .hot-title { font-size: 0.9rem; color: #fbbf24; margin-bottom: 10px; text-transform: uppercase; font-weight: bold; }
        .hot-grid { display: flex; justify-content: space-around; gap: 10px; flex-wrap: wrap; }
        .hot-item { text-align: center; background: #1e293b; padding: 10px; border-radius: 10px; flex: 1; min-width: 80px; border: 1px solid #334155; }
        .hot-num { display: block; font-size: 1.2rem; color: #38bdf8; font-weight: bold; }
        .hot-count { font-size: 0.7rem; color: #94a3b8; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(65px, 1fr)); gap: 10px; margin-top: 25px; }
        .num-item { background: #334155; padding: 12px 5px; text-align: center; border-radius: 8px; font-weight: bold; border-bottom: 3px solid #38bdf8; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .swal2-popup { background: #1e293b !important; color: #e5e7eb !important; border-radius: 20px !important; }
        .swal2-title, .swal2-html-container { color: #e5e7eb !important; }
    </style>
</head>
<body>

<div class="card">
    <h1>üéØ Lao Lottery Cloud</h1>
    <div style="text-align:center">
        <div class="status-badge" id="data-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
    </div>

    <div class="hot-container" id="hot-section" style="display:none;">
        <div class="hot-title">üî• 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢ (Top 5 Hot)</div>
        <div class="hot-grid" id="hot-list"></div>
    </div>

    <label style="display:block; margin-top:20px;">üì• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ß‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß)</label>
    <textarea id="bulkInput" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 085 123 456..."></textarea>
    <button class="btn-import" onclick="importToCloud()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö Cloud</button>
    <button class="btn-undo" onclick="deleteLastEntry()">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

    <hr style="border:0; border-top:1px solid #334155; margin:30px 0;">

    <button class="btn-gen" onclick="generateSmart()">‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î 100 ‡∏ä‡∏∏‡∏î</button>
    <div id="result" class="grid"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBSBP6thMiBi9Jnz663XiWBzDnVgcwTZ0Y",
        authDomain: "lao-lottery-app.firebaseapp.com",
        databaseURL: "https://lao-lottery-app-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "lao-lottery-app",
        storageBucket: "lao-lottery-app.firebasestorage.app",
        messagingSenderId: "5669085764",
        appId: "1:5669085764:web:6b79b5bc41cc0ae7151211",
        measurementId: "G-4VXM6R9C43"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref('history').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) {
            document.getElementById('data-status').innerHTML = `üü¢ Cloud Online: <b>0</b> ‡∏á‡∏ß‡∏î`;
            document.getElementById('hot-section').style.display = 'none';
            return;
        }
        const historyArray = Object.values(data).map(item => item.number);
        document.getElementById('data-status').innerHTML = `üü¢ Cloud Online: <b>${historyArray.length}</b> ‡∏á‡∏ß‡∏î`;
        calculateTop5(historyArray);
    });

    function calculateTop5(numbers) {
        const counts = {};
        numbers.forEach(num => counts[num] = (counts[num] || 0) + 1);
        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 5);

        if (sorted.length > 0) {
            document.getElementById('hot-section').style.display = 'block';
            document.getElementById('hot-list').innerHTML = sorted.map(([num, count]) => `
                <div class="hot-item">
                    <span class="hot-num">${num}</span>
                    <span class="hot-count">‡∏≠‡∏≠‡∏Å ${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                </div>
            `).join('');
        }
    }

    async function importToCloud() {
        const text = document.getElementById('bulkInput').value;
        const found = text.match(/\d{3}/g);

        if (!found) {
            Swal.fire({
                icon: 'error',
                title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 3 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                confirmButtonColor: '#ef4444'
            });
            return;
        }

        const result = await Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?',
            text: `‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${found.length} ‡∏á‡∏ß‡∏î ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#22c55e',
            cancelButtonColor: '#334155',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        });

        if (result.isConfirmed) {
            found.forEach(num => {
                db.ref('history').push({ number: num, createdAt: firebase.database.ServerValue.TIMESTAMP });
            });
            document.getElementById('bulkInput').value = "";
            Swal.fire({ icon: 'success', title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', timer: 1500, showConfirmButton: false });
        }
    }

    async function generateSmart() {
        const snapshot = await db.ref('history').limitToLast(100).once('value');
        const historyData = [];
        snapshot.forEach(child => { historyData.push(child.val().number); });

        const pool = new Set();
        while (pool.size < 100) {
            const n = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            if (n[0] === n[1] && n[1] === n[2]) continue;
            if (historyData.includes(n) && Math.random() > 0.1) continue;
            pool.add(n);
        }
        document.getElementById('result').innerHTML = [...pool].map(n => `<div class="num-item">${n}</div>`).join('');
    }

    async function deleteLastEntry() {
        const snapshot = await db.ref('history').limitToLast(1).once('value');
        if (!snapshot.exists()) return;

        const result = await Swal.fire({
            title: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î?',
            text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#ef4444',
            confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!'
        });

        if (result.isConfirmed) {
            snapshot.forEach(child => child.ref.remove());
            Swal.fire({ icon: 'success', title: '‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', timer: 1500, showConfirmButton: false });
        }
    }
</script>
</body>
</html>
